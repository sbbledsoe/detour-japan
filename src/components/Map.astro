---
interface Location {
  name: string;
  lat: number;
  lng: number;
}

interface Props {
  center: { lat: number; lng: number };
  zoom?: number;
  locations?: Location[];
  prefecture?: string;
}

const { center, zoom = 9, locations = [], prefecture = '' } = Astro.props;
const mapId = `map-${Math.random().toString(36).substring(7)}`;
---

<div class="map-container">
  <div id={mapId} class="map"></div>
  <p class="map-attribution">Map data Â© <a href="https://www.openstreetmap.org/copyright" target="_blank" rel="noopener">OpenStreetMap</a> contributors</p>
</div>

<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="" />

<script define:vars={{ mapId, center, zoom, locations, prefecture }}>
  // Load Leaflet dynamically
  if (!window.L) {
    const script = document.createElement('script');
    script.src = 'https://unpkg.com/leaflet@1.9.4/dist/leaflet.js';
    script.integrity = 'sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=';
    script.crossOrigin = '';
    script.onload = initMap;
    document.head.appendChild(script);
  } else {
    initMap();
  }

  function initMap() {
    const map = L.map(mapId).setView([center.lat, center.lng], zoom);

    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      maxZoom: 19,
    }).addTo(map);

    // Add markers for each location
    locations.forEach(loc => {
      L.marker([loc.lat, loc.lng])
        .addTo(map)
        .bindPopup(`<strong>${loc.name}</strong>`);
    });
  }
</script>

<style>
  .map-container {
    margin: var(--space-lg) 0;
    border-radius: 8px;
    overflow: hidden;
    border: 1px solid var(--border);
  }

  .map {
    height: 300px;
    width: 100%;
    background: var(--bg-secondary);
  }

  .map-attribution {
    font-size: 0.75rem;
    color: var(--text-secondary);
    padding: var(--space-xs) var(--space-sm);
    margin: 0;
    background: var(--bg-secondary);
    text-align: right;
  }

  .map-attribution a {
    color: var(--text-secondary);
    text-decoration: underline;
  }
</style>
